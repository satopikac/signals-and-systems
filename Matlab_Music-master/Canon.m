%Canon song
fs = 8000;
song_t = 4;                           
t = linspace(0,song_t,song_t*fs);      
song = 0 * t;
one_step = 0.5;                         %单节拍时间 
basic_f = 293.66;                       %歌曲基调为D调

song_tone = [	3,2,1,7,...
		6,5,6,7,...
		3,3,1,  2,7, 1,1,6, 7,5,...
		6,6,4, 5,3, 6,6,1, 7,1,2,...
		3,2,3,4, 5,2,5,4, 3,6,5,4, 5,4,3,2,...
		1,6,6,7, 1,7,6,5, 4,3,2,6, 5,6,5,4,...
		5,3,4,5,3,4,  5,5,6,7,1,2,3,4, 3,1,2,3,3,4, 5,6,5,4,5,3,4,5,...
		4,6,5,4,3,2, 3,1,1,2,3,4,5,6, 4,6,5,6,7,1, 5,6,7,1,2,3,4,5,...
		5,5, 5,6,5,4, 3,3, 3,4,3,2,...
		1,1, 1,2,1,7, 6,1, 7,1,2,...
		3, 2,1,7,...
		6,5,6,7,1,7,1,7,1,7,6,7,1];
		

last_time =[	4,4,4,4,...
		4,4,4,4,...
		2,1,1, 3,1, 2,1,1, 3,1,...
		2,1,1, 3,1, 2,1,1, 2,1,1,...
		1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1,...
		1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1,...
		1,0.5,0.5,1,0.5,0.5, 0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5, 1,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,...
		1,0.5,0.5,1,0.5,0.5, 0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5, 1,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,...
		3,1, 1,1,1,1, 3,1, 1,1,1,1,...
		3,1, 1,1,1,1 3,1, 2,1,1,...
		4,4,4,4,...
		4,4,4,0.5,0.5,0.5,0.5,0.25,0.25,0.5,0.5,0.5,4];

song = fourier_song_creation(song_tone,last_time,one_step,fs,basic_f,2);%第一声道的歌
plot(song);


song_tone2 = [	1,5,6,3,...
		4,1,4,5,...
		1,4,6,3,...
		4,1,4,5,...
		1,5,6,3,...
		4,1,4,5,...
		1,5,6,3,...
		4,1,4,5,...
		1,5,6,3,...
		4,1,4,5,...
		1,5,6,3,...
		4,1,4,5,1];
last_time2 = 4*ones(1,length(song_tone2));

song2 = fourier_song_creation(song_tone2,last_time2,one_step,fs,basic_f,5);    %第二声道

Canon_song = song + 0.1*song2;                      %合成
Canon_song = Canon_song/max(Canon_song);            %归一化
plot(Canon_song);
title('Canon');
sound(Canon_song);
audiowrite( 'Canon.wav',Canon_song,fs);